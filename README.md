# Entry Service

Сервис для управления упорядоченным списком записей (`Entry`) с возможностью
перемещения элементов вверх, вниз и в произвольную позицию.

## Возможности

- Получение списка записей с пагинацией  
- Перемещение записи:
  - вверх (`UP`)
  - вниз (`DOWN`)
  - в указанную позицию (`TO_POSITION`)  
- Автоматическая генерация тестовых данных при старте (через Liquibase)

---

## Установка и запуск

### 1. Клонирование проекта

```bash
git clone https://github.com/eliseev-tech/entry-service.git
cd entry-service
```

### 2. Запуск базы данных PostgreSQL

```bash
docker-compose up -d
```

По умолчанию база будет доступна на:
- **host**: `localhost`
- **port**: `5432`
- **database**: `entries`
- **user**: `postgres`
- **password**: `postgres`

### 3. Запуск приложения

```bash
mvn spring-boot:run
```

Сервис поднимется на порту **8080**.

---

## Использование API

Все запросы работают с JSON.  
Базовый URL: `http://localhost:8080`

### Получить список записей

```http
GET /entries?page=0&size=10
```

**Пример ответа:**
```json
{
  "content": [
    { "id": 1, "name": "Entry 1", "position": 1000 },
    { "id": 2, "name": "Entry 2", "position": 2000 }
  ],
  "pageable": { "pageNumber": 0, "pageSize": 10 },
  "totalElements": 10000000,
  "totalPages": 1000000
}
```

---

### Перемещение записи

```http
POST /entries/{id}/move
Content-Type: application/json
```

**Пример запроса (вверх):**
```json
{ "mode": "UP" }
```

**Пример запроса (вниз):**
```json
{ "mode": "DOWN" }
```

**Пример запроса (в указанную позицию):**
```json
{ "mode": "TO_POSITION", "position": 1500 }
```

**Пример ответа:**
```json
{ "id": 5, "name": "Entry 5", "position": 1500 }
```

---

## Генерация тестовых данных

При первом запуске Liquibase автоматически создаёт таблицу `entry` и наполняет её
**10 000 000** тестовыми записями с шагом `1000` в поле `position`.

Эти данные можно использовать для тестирования операций перемещения и пагинации.

---

## Примечания

- Все операции с позициями защищены от конфликтов уникальности (`uq_entry_position`).  
- Если позицию занять невозможно, сервис вернёт ошибку `409 Conflict`.  
- Параметр `GAP` по умолчанию равен **1000** и используется для вставки между элементами.
